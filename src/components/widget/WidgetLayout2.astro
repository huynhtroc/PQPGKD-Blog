---
import { Icon } from "astro-icon/components";
import I18nKey from "@/i18n/i18nKey";
import { i18n } from "@/i18n/translation";

interface Props {
  id: string;
  name?: string;
  isCollapsed?: boolean;
  collapsedHeight?: string;
  class?: string;
  style?: string;
}

const { id, name, isCollapsed, collapsedHeight, style } = Astro.props;
const className = Astro.props.class;
---

<widget-layout-flat
  data-id={id}
  data-is-collapsed={String(isCollapsed)}
  class={"card-base " + className}
  style={style}
>
  {name && (
    <div class="widget-title font-bold text-lg text-neutral-900 dark:text-neutral-100 relative flex items-center justify-between px-4 pt-4 pb-2">
      <span>{name}</span>
      <slot name="title-icon" />
    </div>
  )}

  <!-- â— NO padding -->
  <div
    id={id}
    class:list={[
      "collapse-wrapper overflow-hidden",
      { collapsed: isCollapsed }
    ]}
  >
    <slot />
  </div>

  {isCollapsed && (
    <div class="expand-btn px-4 py-2">
      <button class="btn-plain rounded-lg w-full h-9">
        <div class="text-[var(--primary)] flex items-center justify-center gap-2">
          <Icon name="material-symbols:more-horiz" class="text-[1.75rem]" />
          {i18n(I18nKey.more)}
        </div>
      </button>
    </div>
  )}
</widget-layout-flat>

<style define:vars={{ collapsedHeight }}>
  .collapsed {
    height: var(--collapsedHeight);
  }
</style>

<script>
  class WidgetLayoutFlat extends HTMLElement {
    constructor() {
      super();

      if (this.dataset.isCollapsed !== "true") return;

      const id = this.dataset.id;
      const btn = this.querySelector(".expand-btn");
      const wrapper = this.querySelector(`#${id}`);

      btn?.addEventListener("click", () => {
        wrapper?.classList.remove("collapsed");
        btn.classList.add("hidden");
      });
    }
  }

  if (!customElements.get("widget-layout-flat")) {
    customElements.define("widget-layout-flat", WidgetLayoutFlat);
  }
</script>
